<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title>关于 OpenWrt 的折腾经过 · SelfStudio</title><meta name="description" content="关于 OpenWrt 的折腾经过 - Lincoln.L"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon shortcut" href="/favicon.ico" type="image/x-icon"><link rel="mask-icon" sizes="any" href="/favicon.svg"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://codeeagle.github.io/atom.xml" title="SelfStudio"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">关于 OpenWrt 的折腾经过</h1><span class="post-info post-data-info">2019年8月3日</span><div class="post-content"><p>错入 NetGear R7000p，开始折腾 树莓派 3B+，最后皈依 NetGear R7800</p>
<a id="more"></a>
<div class="toc">

<!-- toc -->
<ul>
<li><a href="#yuan-qi">缘起</a></li>
<li><a href="#shu-mei-pai-de-chang-shi">树莓派的尝试</a></li>
<li><a href="#fan-nao-de-r7000p">烦恼的 R7000p</a></li>
<li><a href="#r7800-de-shua-ji-pei-zhi-zou-liao-da-wan-lu">R7800 的刷机配置走了大弯路</a></li>
<li><a href="#hou-ji">后记</a></li>
</ul>
<!-- tocstop -->
</div>

<h2><span id="yuan-qi">缘起</span><a href="#yuan-qi" class="header-anchor"></a></h2><p>为什么要折腾 OpenWrt 呢，这个问题，应该是日益增长的设备对科学上网的渴望所导致的</p>
<p>一开始就只有电脑和手机有需求，但是开了个 100GB/mo 的套餐，这样花起来就不太值得了，每月都剩下 <code>90%</code> 的流量</p>
<p>还有有时候想让 PS4，NS 等也可以翻墙，都要去装个客户端就太麻烦了</p>
<p>所以思考着，透明网关之类的解决方案</p>
<h2><span id="shu-mei-pai-de-chang-shi">树莓派的尝试</span><a href="#shu-mei-pai-de-chang-shi" class="header-anchor"></a></h2><p>之前工作中接触到和硬件相关的东西，一时兴起买了个 <code>树莓派3B+</code>，最初打算是用来控制开关什么的，后来热情淡了就不了了之了</p>
<p>电脑端一直用着 <code>ClashX</code>，感觉挺好，希望用它来做一个透明网关</p>
<p>在树莓派装好 <code>Ubuntu</code> 装好 <code>Clash</code> 之后，剩下的网关配置等的阻碍了我的脚步，无奈之下只好又尘封它了</p>
<p>直到上周，忘记什么原因，一下子就陷入到 <code>OpenWrt/Lede</code> 中，寻思着拿 <code>树莓派3B+</code> 试试</p>
<p>下载的版本刷到树莓派上，不是 <code>彩屏</code>，就是 <code>Luci</code> 服务跑不起来</p>
<p>还是要自己编译才行</p>
<p>在 <code>macOS</code> 上编译了一下，各种问题，还是要按照推荐，用 <code>Ubuntu</code> 来 build</p>
<p>在安装了个虚拟机，成功编译出 <code>树莓派3B+</code> 的固件，之后就是刷机什么的</p>
<p>刷好 <code>Lede</code> 固件后，基本是开机就用，插上网线就行了</p>
<p>缺点还是有的，<code>树莓派3B+</code> 毕竟是软路由，无线的信号也不是很好很稳定</p>
<p>而且，只能作为辅助热点，不能完全替代路由，可以说是个尝鲜的方案</p>
<h2><span id="fan-nao-de-r7000p">烦恼的 R7000p</span><a href="#fan-nao-de-r7000p" class="header-anchor"></a></h2><p>不知道什么么错觉，让我以为家里的路由器是 <code>R7800</code>，在后台看到是 <code>R7000p</code> 的那一刻，我竟然怀疑是之前返修调包了，赶紧翻出订单一看，确实是 <code>R7000P</code></p>
<p>当时入手的时候以为只要是 <code>NetGear</code> 都能刷固件什么的，虽然也不是错的离谱</p>
<p><code>R7000P</code> 就是主流的 <code>OpenWrt/Lede</code> 刷不了，只能刷 <code>DDWrt</code> 之类的</p>
<p>有想过还是算了吧，就刷刷 <code>DDWrt</code> 将就下，但是只有一个路由器，刷坏了比较麻烦</p>
<p>想象还是狠下心来，入手个 <code>R7800</code> 刚好遇上电竞节，999 入手了</p>
<h2><span id="r7800-de-shua-ji-pei-zhi-zou-liao-da-wan-lu">R7800 的刷机配置走了大弯路</span><a href="#r7800-de-shua-ji-pei-zhi-zou-liao-da-wan-lu" class="header-anchor"></a></h2><p>刷机很顺利，直接在网页后台上传就行了，但是刷完机，我手贱，用 <code>树莓派3B+</code> 的配分直接恢复了配置，这导致了接下来的灾难</p>
<p>显示自己去看怎么配置 <code>WAN</code>，搜索有没有人共享出来 <code>R7800</code> 的配置，一夜郁闷的睡了</p>
<p>首先是一直只能利用不同网段去开配置后台，配置好后，科学上网组件运行不起来，访问不了外网。。。</p>
<p>开启作死模式，各种尝试修改配置</p>
<p><code>R7800</code> 很多时候要重启才生效，配置</p>
<p>最糟糕的第二天，直接把 <code>br-lan</code> 从 静态地址 改成 <code>pope</code> 拨号，导致 <code>ssh</code> 彻底连不上了</p>
<p>至暗时刻，甚至想过这就是代价，认了</p>
<p>但是看到说有不死 <code>uboot</code>，可以用 <code>tftp</code> 刷回来</p>
<p>在 <code>windows</code> 下总算刷机成功，满血复活（吐槽下，windows 的命令行太难用了）</p>
<p>再次刷机，不恢复配置，网线直接插 WAN 口就能用了，之前到底是多蠢。。。。</p>
<p>所以网上也没有所谓的 <code>R7800</code> 的配置下载。。。。</p>
<h2><span id="hou-ji">后记</span><a href="#hou-ji" class="header-anchor"></a></h2><p>配置好科学上网后，算是成功第一步了，家里的所有设备都可几无感接入了</p>
<p>后面再研究下有什么新玩法</p>
<p>还精简了些服务，lede 自带比较多功能，有些用不上，浪费内存</p>
</div></article></div></main><footer><div class="paginator"><a href="/2018/09/17/GPG-with-multiple-accounts/" class="next">下一篇</a></div><div id="gitalk-container"></div><link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css"><script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script><script>const gitalk = new Gitalk({
  clientID: 'c044c998fa94bffa71eb',
  clientSecret: '1eb2f5b6e9af8dbe0b2381a0c449dce57bb9e356',
  repo: 'Comments',
  owner: 'CodeEagle',
  admin: ['CodeEagle'],
  id: window.location.pathname,      // Ensure uniqueness and length less than 50
  distractionFreeMode: true  // Facebook-like distraction free mode
})
gitalk.render('gitalk-container')</script><div class="copyright"><p>© 2018 - 2020 <a href="https://codeeagle.github.io">Lincoln.L</a> Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">Apollo</a>.</p><a href="https://github.com/CodeEagle"><svg height="18" viewbox="0 0 16 16" width="18"><path fill="#aaa" fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path></svg></a><span>&nbsp;&nbsp;&nbsp;<a href="https://twitter.com/_SelfStudio"><svg width="18" height="18" viewbox="0 0 250 250"><path d="M78.62,226.59 C172.96,226.59 224.56,148.43 224.56,80.65 C224.56,78.43 224.56,76.22 224.41,74.02 C234.448314,66.7591086 243.113555,57.768794 250,47.47 C240.638791,51.6180177 230.708293,54.3382865 220.54,55.54 C231.24744,49.1298206 239.261235,39.0477199 243.09,27.17 C233.021575,33.1445532 222.006461,37.3551202 210.52,39.62 C194.620828,22.7139428 169.357194,18.5761258 148.895493,29.5267993 C128.433792,40.4774727 117.86275,63.7932573 123.11,86.4 C81.8689574,84.3324954 43.4447578,64.8532327 17.4,32.81 C3.78622756,56.2464473 10.7398788,86.2285948 33.28,101.28 C25.117412,101.038075 17.1327937,98.8361318 10,94.86 C10,95.07 10,95.29 10,95.51 C10.0066813,119.92593 27.2175149,140.955352 51.15,145.79 C43.598696,147.8494 35.6758059,148.150443 27.99,146.67 C34.7094793,167.564228 53.9657456,181.877839 75.91,182.29 C57.7473504,196.564319 35.3105951,204.313277 12.21,204.29 C8.12903569,204.282165 4.05204065,204.035075 0,203.55 C23.4563595,218.602766 50.749134,226.587169 78.62,226.55" fill="#aaa" fill-rule="evenodd"></path></svg></a><span>&nbsp;&nbsp;&nbsp;</span><a href="/atom.xml"><svg height="18" viewbox="0 0 16 16" width="18"><path style="fill:#aaa;" d="M3.011,0.005C1.354,0.005,0,1.349,0,3.005c0,0.073,0.005,8.795,0.005,9c0,2.209,1.793,4,4.002,4            c0.184,0,8.908,0.001,9.003,0.001c1.655,0,3-1.346,3-3.001C16.011,5.826,10.191,0.005,3.011,0.005z M4.012,14.005            c-1.105,0.002-2.001-0.894-2.001-1.999c-0.002-1.105,0.894-2.001,2.001-2.001c1.105-0.002,2.001,0.894,1.999,2.001            C6.013,13.11,5.117,14.006,4.012,14.005z M8.511,14.005c-0.829,0-1.5-0.671-1.5-1.5c0-1.931-1.57-3.5-3.5-3.5            c-0.829,0-1.5-0.671-1.5-1.5s0.671-1.5,1.5-1.5c3.584,0,6.5,2.916,6.5,6.5C10.011,13.333,9.34,14.005,8.511,14.005z M12.511,14.005            c-0.829,0-1.5-0.671-1.5-1.5c0-4.136-3.364-7.5-7.5-7.5c-0.829,0-1.5-0.671-1.5-1.5s0.671-1.5,1.5-1.5c5.79,0,10.5,4.71,10.5,10.5            C14.011,13.333,13.34,14.005,12.511,14.005z"></path></svg></a></span></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-119557423-1",'auto');ga('send','pageview');</script></body></html>